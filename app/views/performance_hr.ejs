<%- include('includes/head.ejs') %>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    
            <body>
            <div class="container-scroller">
              <!-- partial:partials/_navbar.html -->
              <%- include('includes/navbar.ejs') %>
              <!-- partial -->
              <div class="container-fluid page-body-wrapper">
                <!-- partial -->
                <!-- partial:partials/_sidebar.html -->
                <%- include('includes/sidebar.ejs') %>
                <!-- partial -->
                <div class="main-panel"> <div class="content-wrapper">
                  <div class="row">
                    <div class="col-md-12 grid-margin">
                      <div class="row">
                        <div class="col-12 col-xl-8 mb-4 mb-xl-0">
                          <h3 class="font-weight-bold">Hr Performance</h3>
                          <% if (filterHrdata != undefined) { %>
                            <a href="/panel/performance_hr" class="btn btn-primary">Back</a>
                            <% } %>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12 ">
                        <div class="card shadow mb-4">
                          <div class="card-header">
                            <div class="row">
                              <div class="col-md-6">
                                <form id="filterHrForm" method="post" action="/panel/filter_performance_hr">
                                  <input type="hidden" name="_csrf" value="<%=csrfToken%>" />
                                  <div class="form-group">
                                    <select class="form-control" id="filterSelect" name="filterSelect">
                                      <option value="-1" > Select HR </option>
                                      <% hrData.forEach(option => { %>
                                          <option value="<%= option.email %>"><%= option.email %></option>
                                      <% }); %>
                                    </select>
                                  </div>
                                </div>
                                <div class="col-md-6 text-right"> 
                                  <button id="filterHrBtn" class="btn btn-primary" type="submit">Filter</button>
                                </div>
                              </form>
                            </div>
                          </div>
                          <% if (filterHrdata == undefined) { %>
                        <div class="card-body">  

                          <div class="table-responsive">
                            <table  class="table table-striped display expandable-table"  width="100%" cellspacing="0">
                                <thead class="table-light">
                                    <tr class=" text-center">                   
                                        <!-- <th>Id</th> -->
                                        <th>SNo.</th>
                                        <th>Title</th>
                                        <th>Candidate Email</th>
                                        <th>Alloted HR</th>
                                        <th>Start Time</th>
                                        <th>End Time</th>
                                        <th>Report Date</th>
                                        <th>Process Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                  
                                  <% for (var i = 0;i < mdata.length ; i++) {%>
                        
                                        <tr>
                                            <!-- <td><%= mdata[i].id %></td> -->
                                            <td><%= i+1 %></td>
                                            <td><%= mdata[i].title %></td>
                                            <td><%= mdata[i].email %></td>
                                            <td><%= mdata[i].alloted_HR %></td>
                                            <td><%= mdata[i].start_time %></td>
                                            <td><%= mdata[i].end_time %></td>
                                            <td><%= mdata[i].updatedAt %></td>
                                            <td><% if(mdata[i].process_status == "1"){%>
                                                <span class="text-success font-weight-bold">Completed</span>
                                                <%}else{%>
                                                <span class="text-warning font-weight-bold">Pending</span>
                                                <% } %>
                                            </td>
                                        </tr>
                                        <% } %>
                                </tbody>
                                </tfoot>
                            </table>
                          </div>                    
                        </div>
                        <% } else { %>
                          <div class="card-body">  
                            <div class="table-responsive">
                              <table  class="table table-striped display expandable-table" id="myTable2" width="100%" cellspacing="0">
                                  <thead class="table-light">
                                      <tr class=" text-center">                   
                                        <th>HR</th>
                                        <th>Total Meetings</th>
                                        <th>Meetings in Month</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      <tr>
                                        <td><%= email && email != undefined ? email : '' %></td>
                                        <td><%= filterHrdata[0].total_meetings ? filterHrdata[0].total_meetings : 0 %></td>
                                        <td><%= filterHrdata[0].month_meetings ? filterHrdata[0].month_meetings : 0 %></td>
                                      </tr>
                                  </tbody>
                                  </tfoot>
                              </table>
                            </div>                    
                          </div>
                          <% } %>                
                        </div>
                      </div>
                    </div>
                </div>
       
                  <!-- content-wrapper ends -->
                  <!-- partial:partials/_footer.html -->
                  <%- include('includes/footer.ejs') %>
                  <!-- partial -->
                </div>
                <!-- main-panel ends -->
              </div>
              <!-- page-body-wrapper ends -->
            </div>

</body>

<!-- <script>
  $(document).ready(function() {
    // Attach a submit event handler to the form
    $('#filterHrForm').submit(function(e) {
      // Prevent the default form submission
      e.preventDefault();

      // Get the selected value from the dropdown
      var selectedValue = $('#filterSelect').val();

      // Check if the selected value is not -1
      if (selectedValue !== '-1') {

        // Make an AJAX POST request
        $.ajax({
          type: 'POST',
          url: '/filter_performance_hr', // Replace with your actual URL
          data: selectedValue,
          success: function(response) {
            // Handle the success response here
            console.log('Success:', response);
          },
          error: function(error) {
            // Handle the error response here
            console.error('Error:', error);
          }
        });
      } else {
        // Show an alert if the selected value is -1
        alert('Please select a valid HR.');
      }
    });
  });
</script> -->

<script>
  $(document).ready(function () {
    // Add submit event listener to the form
    $("#filterHrForm").submit(function (event) {
      // Get the selected value
      var selectedValue = $("#filterSelect").val();

      // Check if the selected value is not equal to -1
      if (selectedValue === "-1") {
        // Prevent form submission
        event.preventDefault();
        alert("Please select an HR");
      }
      // else, the form will be submitted
    });
  });
</script>
<!-- added beacause it is not working properly -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script>

<script>
  $(document).ready(function() {
      $('table').DataTable({
          dom: 'Bfrtip',
          buttons: [
              'copy', 'csv', 'excel', 'pdf', 'print'
          ]
      });
  });
</script>